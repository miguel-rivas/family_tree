<html>
  <head>
    <style>
      html,
      body {
        background: #222;
        color: #ccc;
      }
    </style>
  </head>
  <body>
    <pre id="output"></pre>
    <script>
      console.clear()

      const familyEntries = [
        {
          id: 0,
          name: ['Pedro', 'Antonio'],
          familyName: ['Ramirez', 'Rivas'],
          spouses: [1],
          root: true,
        },
        {
          id: 1,
          name: ['Eleonora', 'del Carmen'],
          familyName: ['Grullon'],
        },
        {
          id: 2,
          name: ['Pedro', 'Antonio'],
          parents: [0, 1],
        },
        {
          id: 3,
          name: ['Juan', 'de Jesus'],
          parents: [0, 1],
        },
        {
          id: 4,
          alias: 'Mama Julia',
          name: ['Ana', 'Julia'],
          familyName: ['Ana', 'Maria'],
          foster_parents: [0, 1],
        },
        {
          id: 5,
          alias: 'Amable',
          name: ['Amable'],
          parents: [0],
        },
      ]

      function getPerson(id) {
        return familyEntries.filter(item => item.id === id)[0]
      }

      function getFamilyName(familyName, parents) {
        const hasOneParent = parents?.length < 2

        if (familyName) {
          return familyName
        } else if (!familyName && hasOneParent) {
          return getPerson(parents[0])?.familyName
        } else {
          return parents.map(parent => {
            return getPerson(parent)?.familyName?.[0]
          })
        }
      }

      function getChildren(id) {
        let result = familyEntries
          .filter(person => {
            const hasCurrentPersonAsParent = person?.parents?.some(
              parent => parent === id
            )
            return hasCurrentPersonAsParent
          })
          .map(person => spreadData(person))
        return result?.length > 0 ? result : undefined
      }

      function getFosterChildren(id) {
        let result = familyEntries
          .filter(person => {
            const hasCurrentPersonAsFosterParent = person?.foster_parents?.some(
              parent => parent === id
            )
            return hasCurrentPersonAsFosterParent
          })
          .map(person => spreadData(person))
        return result?.length > 0 ? result : undefined
      }

      function getSiblings(id, parents) {
        let result = familyEntries
          .filter(person => {
            const isSamePerson = person?.id === id
            const hasSameParents =
              person?.parents?.toString() === parents?.toString()
            return !isSamePerson && hasSameParents
          })
          .map(person => spreadData(person, false))

        return result?.length > 0 ? result : undefined
      }

      function getHalfSiblings(id, currentPersonParents) {
        const result = familyEntries
          .filter(person => {
            const isSamePerson = person?.id === id
            const hasSameParents =
              person?.parents?.toString() === currentPersonParents?.toString()
            const hasOneParent = person?.parents?.some(parent =>
              currentPersonParents?.some(
                currentPersonParent => currentPersonParent === parent
              )
            )
            return !isSamePerson && !hasSameParents && hasOneParent
          })
          .map(person => spreadData(person, false))

        return result?.length > 0 ? result : undefined
      }

      function getSpouses(spouses) {
        const result = spouses
          ?.map(getPerson)
          .map(person => spreadData(person, false))

        return result?.length > 0 ? result : undefined
      }

      function getParents(parents) {
        const result = parents
          ?.map(getPerson)
          .map(person => spreadData(person, false))

        return result?.length > 0 ? result : undefined
      }

      function getFosterParents(parents) {
        const result = parents
          ?.map(getPerson)
          .map(person => spreadData(person, false))

        return result?.length > 0 ? result : undefined
      }

      function spreadData(person, deep = true) {
        const spouses = getSpouses(person?.spouses)
        const parents = getParents(person?.parents)
        const foster_parents = getFosterParents(person?.foster_parents)
        const familyName = getFamilyName(person?.familyName, person?.parents)

        let children, siblings, half_siblings, foster_children

        if (deep) {
          siblings = getSiblings(person?.id, person?.parents)
          half_siblings = getHalfSiblings(person?.id, person?.parents)
          children = getChildren(person?.id)
          foster_children = getFosterChildren(person?.id)
        }

        return {
          id: person?.id,
          name: person?.name,
          familyName,
          ...(person?.alias && { alias: person.alias }),
          ...(deep && {
            root: person?.root,
            relationships: {
              ...(spouses && { spouses }),
              ...(parents && { parents }),
              ...(foster_parents && { foster_parents }),
              ...(children && { children }),
              ...(siblings && { siblings }),
              ...(half_siblings && { half_siblings }),

              // nephews_nieces
              // uncles_aunts,

              // first_cousins,
              // second_cousins,

              // parents_first_cousins,
              // parents_second_cousins,

              // grandparents,
              // granduncle_grandaunt,

              // greatgrandparents,
              // greatduncle_greataunt
            },
          }),
        }
      }

      const familyBase = familyEntries.map(person => spreadData(person))

      function getRoot(familyBase) {
        return familyBase.filter(person => person?.root)
      }

      const family = getRoot(familyBase)

      console.log(family)

      document.getElementById('output').innerHTML = JSON.stringify(
        family,
        null,
        4
      )
    </script>
  </body>
</html>
